# CardsLite PHP - Telegram Bot

Telegram –±–æ—Ç –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ –º–∏–Ω–∏-–∏–≥—Ä—ã —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **PHP**: 8.1+
- **Eloquent ORM** (illuminate/database) - –∫–∞–∫ –≤ Laravel!
- **Telegram Bot SDK**: irazasyed/telegram-bot-sdk v3.15
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: MySQL 8.0
- **–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã**: Long Polling
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: .env —Ñ–∞–π–ª (phpdotenv)
- **Docker**: –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
CardsLitePHP/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ Models/           # Eloquent –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ bootstrap/            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ config/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ migrations/       # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ Database.php     # –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ Eloquent
‚îÇ   ‚îú‚îÄ‚îÄ Utils.php        # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ UI.php           # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ bot.php              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ migrate              # CLI –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ Makefile             # –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml   # Local –æ–∫—Ä—É–∂–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ docker-compose.prod.yml # Production
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
make env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env: BOT_TOKEN –∏ ADMIN_ID

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ + –ë–î + –±–æ—Ç)
make setup

# 3. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make logs
```

### Production

```bash
# 1. –°–æ–∑–¥–∞—Ç—å .env —Å APP_ENV=production
cp .env.example .env
# APP_ENV=production, —É–∫–∞–∂–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –∏ DB –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å
make prod-up
make migrate
```

## üìã –ö–æ–º–∞–Ω–¥—ã (Makefile)

```bash
make help              # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make up                # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make down              # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
make logs              # –õ–æ–≥–∏ –±–æ—Ç–∞
make migrate           # –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-status    # –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
make shell             # –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
make deploy            # Git pull + restart (prod)
```

## üéÆ –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å

1. **–ò–≥—Ä–æ–∫ 1** —Å–æ–∑–¥–∞–µ—Ç –∫–æ–º–Ω–∞—Ç—É (`/create_room <topic_id>`) ‚Üí –ø–æ–ª—É—á–∞–µ—Ç `room_id`
2. **–ò–≥—Ä–æ–∫ 2** –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è (`/join_room <room_id>`) ‚Üí –∏–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
3. –û–±–∞ –ø–æ–ª—É—á–∞—é—Ç –≤–æ–ø—Ä–æ—Å #1
4. –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí –æ—Ç–≤–µ—Ç—ã —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–æ–≤ –æ–±–æ–∏—Ö
5. –û–±–∞ –Ω–∞–∂–∏–º–∞—é—Ç `‚ñ∂Ô∏è –î–∞–ª–µ–µ` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å #2
6. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ –∫–æ–Ω—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
7. –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è ‚Üí –∫–æ–º–Ω–∞—Ç–∞ —É–¥–∞–ª—è–µ—Ç—Å—è

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

- `/start` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º
- `/topics` - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã
- `/create_room <topic_id>` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É
- `/join_room <room_id>` - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ (–∏–ª–∏ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–ª—è –≤–≤–æ–¥–∞ ID)
- `/stop` - –í—ã–π—Ç–∏ –∏–∑ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä—ã

### –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

- `/add_topic` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è ADMIN_ID)

**–§–æ—Ä–º–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤:**
```
1.–ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å
2.–í—Ç–æ—Ä–æ–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å
3.–¢—Ä–µ—Ç–∏–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–°—Ö–µ–º–∞ MySQL (—á–µ—Ä–µ–∑ Eloquent):**

- `topics` - —Ç–µ–º—ã –¥–ª—è –∏–≥—Ä
- `questions` - –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–º–∞–º
- `rooms` - –∏–≥—Ä–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã
- `answers` - –æ—Ç–≤–µ—Ç—ã –∏–≥—Ä–æ–∫–æ–≤
- `chat_messages` - –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ —á–µ—Ä–µ–∑ `make migrate`.

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –∫–∞–∫ –≤ Laravel:

```bash
make migrate           # –í—ã–ø–æ–ª–Ω–∏—Ç—å pending –º–∏–≥—Ä–∞—Ü–∏–∏
make migrate-status    # –°—Ç–∞—Ç—É—Å
make migrate-rollback  # –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π batch
make migrate-fresh     # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤—Å–µ (‚ö†Ô∏è –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö!)
```

## üéØ Local vs Production

| | Local | Production |
|---|---|---|
| **APP_ENV** | `local` | `production` |
| **MySQL** | –í Docker | –°–∏—Å—Ç–µ–º–Ω—ã–π |
| **Docker Compose** | `docker-compose.yml` | `docker-compose.prod.yml` |
| **–ö–æ–º–∞–Ω–¥—ã** | `make up` | `make prod-up` |

## üìù –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
APP_ENV=local              # local –∏–ª–∏ production
BOT_TOKEN=xxx              # –û—Ç @BotFather
ADMIN_ID=123456           # –í–∞—à Telegram ID

DB_TYPE=mysql
DB_HOST=localhost         # mysql (local) –∏–ª–∏ localhost (prod)
DB_PORT=3306
DB_NAME=cardslite
DB_USER=cardslite
DB_PASS=cardslite_password
```